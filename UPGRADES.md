

# Updates

## From Vervion 0.3.x to 0.4.0

### New Values

| Value                                    | example                        | required |
|------------------------------------------|--------------------------------|----------|
| klustairfrontend.adminUser               | admin                          |          |
| klustairfrontend.adminEmail              | admin@changeme.com             |          |
| klustairfrontend.adminPassword           | [autogenerated if empty]       |          |
| klustairfrontend.apiToken                | [generated in Frontend]        |    YES   |
| klustairJob.namespace                    | klustair,default               |          |
| klustairJob.kubeaudit                    | all                            |          |
| klustairJob.serviceAccount.create        | false                          |          |
| klustairJob.serviceAccount.annotations   | {}                             |          |
| klustairJob.rbac.create                  | false                          |          |
| klustairJob.apiHost                      | https://YOURAPP.herokuapp.com (or empty for local frontend)|          |
| klustairJob.configKey                    | [generated in Frontend]        |          |

The apiToken is required, since it it used to authenticate the runner. It can be generaten in the "config" section of the Frontend (only visible when logged in).

### Bitnami PostgreSQL Subchart upgrade 

Prepare variables
``` 
export NAMESPACE=[THE_NAMESPACE_KLUSTAIR_IS_RUNNING]
export POSTGRESQL_PASSWORD=$(kubectl get secret --namespace $NAMESPACE $NAMESPACE-postgresql -o jsonpath="{.data.postgresql-password}" | base64 --decode)
export POSTGRESQL_PVC=$(kubectl get pvc -l app.kubernetes.io/instance=$NAMESPACE,role=master -o jsonpath="{.items[0].metadata.name}")
```

Upgrade Subchart
```
kubectl delete statefulsets.apps $NAMESPACE-postgresql --cascade=false

helm upgrade \
    -f ./klustair/values.dev.yaml \
    --set postgresql.postgresqlPassword=$POSTGRESQL_PASSWORD \
    --set postgresql.persistence.existingClaim=$POSTGRESQL_PVC \
    $NAMESPACE ./klustair

kubectl delete pod $NAMESPACE-postgresql-0
```